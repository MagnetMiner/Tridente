<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>ZORD S.p.A. | CIC TRIDENTE v10.1 üî±</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        :root {
            --bg-deep: #0A0B0C; --steel: #1A2B3C; --alert-yellow: #FFFF00;
            --matrix-green: #00FF41; --hostile-red: #FF0000; --glow-blue: #00AAAA;
        }
        body { margin: 0; background: var(--bg-deep); font-family: 'Courier New', monospace; color: white; overflow: hidden; }
        
        /* Layout Monitor Dual */
        .main-container { display: grid; grid-template-columns: 1fr 400px; height: 100vh; gap: 2px; background: var(--steel); }
        .quadrant { background: var(--bg-deep); display: flex; flex-direction: column; overflow: hidden; border: 1px solid var(--steel); }
        .q-header { 
            background: rgba(26, 43, 60, 0.8); padding: 10px 15px; font-size: 11px; 
            color: var(--glow-blue); border-bottom: 1px solid var(--steel);
            display: flex; justify-content: space-between; letter-spacing: 2px; text-transform: uppercase;
        }

        #map { flex-grow: 1; background: #070809; z-index: 1; }
        
        /* Panel Lateral (B, C, D) */
        .side-panel { display: flex; flex-direction: column; height: 100%; border-left: 2px solid var(--steel); }
        .fixed-data { flex-shrink: 0; border-bottom: 2px solid var(--steel); background: rgba(5, 10, 15, 0.95); }
        .data-section { padding: 15px 20px; }
        
        .log-container { flex-grow: 1; font-size: 10px; color: #8899AA; padding: 12px; overflow-y: auto; background: #050607; }
        .log-line { margin-bottom: 6px; border-left: 2px solid var(--matrix-green); padding-left: 8px; }

        /* Indicadores T√°cticos */
        .stat-bar { background: #111; height: 8px; margin: 6px 0; border: 1px solid var(--steel); }
        .bar-fill { height: 100%; background: var(--matrix-green); width: 0%; transition: width 0.5s; }
        .alert-text { color: var(--hostile-red); font-weight: bold; animation: blink 1s infinite; }
        .info-label { color: #556677; font-size: 9px; text-transform: uppercase; display: block; margin-top: 10px; }
        .info-value { color: #fff; font-size: 12px; font-weight: bold; }

        /* Etiqueta Militar de Boya */
        .buoy-label {
            background: rgba(0, 20, 30, 0.9) !important;
            border: 1px solid var(--glow-blue) !important;
            color: var(--glow-blue) !important;
            font-family: 'Courier New', monospace !important;
            font-size: 9px !important;
            letter-spacing: 2px !important;
            padding: 2px 5px !important;
            border-radius: 0 !important;
            box-shadow: 0 0 8px rgba(0, 255, 255, 0.2);
        }

        /* Men√∫ de Respuesta */
        #action-menu {
            position: absolute; display: none; background: rgba(10, 11, 12, 0.98); 
            border: 1px solid var(--hostile-red); padding: 12px; z-index: 5000; width: 200px;
        }
        .action-btn {
            width: 100%; background: #1a0505; color: var(--hostile-red); border: 1px solid var(--hostile-red);
            padding: 8px; cursor: pointer; margin-top: 6px; font-family: inherit; font-size: 10px; font-weight: bold;
        }
        .action-btn:hover { background: var(--hostile-red); color: white; }

        @keyframes blink { 0%, 100% { opacity: 1; } 50% { opacity: 0.3; } }
        #boot-screen { position: absolute; inset: 0; background: var(--bg-deep); z-index: 9999; display: flex; flex-direction: column; align-items: center; justify-content: center; }
    </style>
</head>
<body>

<div id="boot-screen">
    <div style="color: var(--matrix-green); margin-bottom: 20px; font-size: 20px; letter-spacing: 10px;">ZORD TACTICAL SYSTEMS</div>
    <button style="background:none; border: 1px solid var(--matrix-green); color: var(--matrix-green); padding: 15px 30px; font-family: inherit; cursor: pointer; font-weight: bold;" onclick="bootSystem()">EJECUTAR PROTOCOLO TRIDENTE</button>
</div>

<div id="action-menu">
    <div style="font-size: 9px; color: var(--hostile-red); margin-bottom: 8px; text-align: center; border-bottom: 1px solid #300;">ORDEN DE ENGANCHE</div>
    <button class="action-btn" onclick="takeAction('PATRULLA DESPACHADA')">INTERCEPCI√ìN SUPERFICIE</button>
    <button class="action-btn" style="color: var(--alert-yellow); border-color: var(--alert-yellow);" onclick="takeAction('ALERTA ASW ACTIVADA')">NEUTRALIZACI√ìN ASW</button>
    <button class="action-btn" style="color: #666; border-color: #333;" onclick="closeMenu()">CANCELAR</button>
</div>

<div class="main-container">
    <div class="quadrant">
        <div class="q-header">
            <span>TSD: TACTICAL SITUATION DISPLAY</span>
            <span id="coord-header" style="color: var(--matrix-green);">SYS_READY</span>
        </div>
        <div id="map"></div>
    </div>

    <div class="side-panel">
        <div class="fixed-data">
            <div class="q-header"><span>B: CINEM√ÅTICA Z-ENGINE</span></div>
            <div class="data-section">
                <div id="wait-msg" style="color: #445566; text-align: center; font-size: 11px; padding: 10px 0;">ESCANEO AC√öSTICO PASIVO...</div>
                <div id="target-data" style="display:none;">
                    <div class="alert-text" style="font-size: 11px; margin-bottom: 10px;">‚ö†Ô∏è CONTACTO HOSTIL VALIDADO</div>
                    <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px;">
                        <div>
                            <span class="info-label">GPS LAT</span><span class="info-value" id="side-lat">--</span>
                            <span class="info-label">RUMBO (HDG)</span><span class="info-value" id="side-hdg">--</span>
                        </div>
                        <div>
                            <span class="info-label">GPS LON</span><span class="info-value" id="side-lon">--</span>
                            <span class="info-label">VELOCIDAD</span><span class="info-value" id="side-spd">--</span>
                        </div>
                    </div>
                    <span class="info-label">CONFIANZA DE RED</span>
                    <span class="info-value" id="side-conf">--</span>
                    <span class="info-label">TAT PUERTO PROX.</span>
                    <span class="info-value" id="side-tat">--</span>
                </div>
            </div>
        </div>

        <div class="fixed-data">
            <div class="q-header"><span>C: ENGINE HEALTH & ENTROPY</span></div>
            <div class="data-section" style="padding: 10px 20px;">
                <div class="stat-bar"><div class="bar-fill" style="width: 88%;"></div></div>
                <div style="font-size: 8px; color: var(--glow-blue);">L-SUSY LAYER: STABLE (99.9%)</div>
            </div>
        </div>

        <div class="quadrant" style="flex-grow: 1; border-top: none;">
            <div class="q-header"><span>D: MISSION LOG & SIGNATURES</span></div>
            <div id="mission-log" class="log-container"></div>
        </div>
    </div>
</div>

<script>
    const map = L.map('map', { zoomControl: false, attributionControl: false }).setView([-33.00, -72.40], 8);
    L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { opacity: 0.6 }).addTo(map);

    const PORTS = { "VALPARA√çSO": [-33.03, -71.62], "SAN ANTONIO": [-33.58, -71.61] };
    const R_PRIMARY = 35000;
    const R_SECONDARY = 60000;
    
    const buoys = [
        { id: "B01", lat: -32.10, lon: -72.60 }, { id: "B02", lat: -32.50, lon: -71.95 },
        { id: "B03", lat: -32.90, lon: -72.55 }, { id: "B04", lat: -33.20, lon: -72.05 },
        { id: "B05", lat: -33.60, lon: -72.50 }, { id: "B06", lat: -33.90, lon: -72.00 }
    ];

    const buoyLayers = [];
    buoys.forEach(b => {
        const sZone = L.circle([b.lat, b.lon], { radius: R_SECONDARY, color: 'var(--alert-yellow)', weight: 0.5, dashArray: '2, 4', fill: false, opacity: 0 }).addTo(map);
        const pZone = L.circle([b.lat, b.lon], { radius: R_PRIMARY, color: 'var(--matrix-green)', weight: 0.8, fillOpacity: 0, opacity: 0 }).addTo(map);
        L.circleMarker([b.lat, b.lon], { color: 'var(--glow-blue)', radius: 2, fillOpacity: 1 }).addTo(map)
            .bindTooltip(b.id, { permanent: true, direction: 'top', className: 'buoy-label', offset: [0, -12], opacity: 0.9 });
        buoyLayers.push({ b, pZone, sZone });
    });

    const waypoints = [
        {lat: -31.80, lon: -73.00}, {lat: -32.30, lon: -72.40}, {lat: -32.70, lon: -72.05},
        {lat: -33.10, lon: -72.50}, {lat: -33.50, lon: -72.15}, {lat: -34.80, lon: -73.00}
    ];
    
    let currentWP = 0;
    let target = { lat: waypoints[0].lat, lon: waypoints[0].lon, heading: 0, speed: 22.4, marker: null, visible: false };

    function addLog(text) {
        const log = document.getElementById('mission-log');
        log.innerHTML += `<div class="log-line">[${new Date().toLocaleTimeString('en-GB')}] ${text}</div>`;
        log.scrollTop = log.scrollHeight;
    }

    function bootSystem() {
        document.getElementById('boot-screen').style.display = 'none';
        addLog("Z-ENGINE INITIALIZED. SCANNING SPECTRAL GAPS...");
        
        const hostileIcon = L.divIcon({
            className: 'hostile-icon',
            html: `<div id="tgt-symbol" style="width:0; height:0; border-left:7px solid transparent; border-right:7px solid transparent; border-bottom:16px solid var(--hostile-red); filter: drop-shadow(0 0 5px red);"></div>`,
            iconSize: [14, 16], iconAnchor: [7, 8]
        });

        target.marker = L.marker([target.lat, target.lon], {icon: hostileIcon});
        target.marker.on('click', (e) => {
            const menu = document.getElementById('action-menu');
            menu.style.display = 'block'; menu.style.left = e.originalEvent.pageX + 'px'; menu.style.top = e.originalEvent.pageY + 'px';
        });

        setInterval(simulationLoop, 100);
    }

    function simulationLoop() {
        let wp = waypoints[currentWP + 1];
        if (!wp) return;

        let dy = wp.lat - target.lat; let dx = wp.lon - target.lon;
        let distToWP = Math.sqrt(dy*dy + dx*dx);
        if (distToWP < 0.04) currentWP++;

        let targetHeading = Math.atan2(dx, dy) * (180 / Math.PI);
        if (targetHeading < 0) targetHeading += 360;
        target.heading += (targetHeading - target.heading) * 0.1;

        target.lat += Math.cos(target.heading * Math.PI/180) * 0.005;
        target.lon += Math.sin(target.heading * Math.PI/180) * 0.005;

        let detections = 0;
        buoyLayers.forEach(l => {
            const d = map.distance([target.lat, target.lon], [l.b.lat, l.b.lon]);
            if (d < R_SECONDARY) { detections++; l.sZone.setStyle({ opacity: 0.6 }); }
            else { l.sZone.setStyle({ opacity: 0 }); }

            if (d < R_PRIMARY) { l.pZone.setStyle({ opacity: 0.8, fillOpacity: 0.1 }); }
            else { l.pZone.setStyle({ opacity: 0, fillOpacity: 0 }); }
        });

        if (detections > 0) {
            if (!target.visible) { target.marker.addTo(map); target.visible = true; addLog("‚ö†Ô∏è NON-TRIVIAL ZERO CORRELATION DETECTED."); }
            updateHUD(detections);
        } else if (target.visible) {
            map.removeLayer(target.marker); target.visible = false; hideHUD(); addLog("LOST CONTACT: SIGNAL BELOW NOISE FLOOR.");
        }

        if (target.visible) {
            target.marker.setLatLng([target.lat, target.lon]);
            document.getElementById('tgt-symbol').style.transform = `rotate(${target.heading}deg)`;
            document.getElementById('coord-header').innerText = `${Math.abs(target.lat).toFixed(3)}¬∞S | ${Math.abs(target.lon).toFixed(3)}¬∞W`;
        }
    }

    function updateHUD(count) {
        document.getElementById('target-data').style.display = 'block';
        document.getElementById('wait-msg').style.display = 'none';
        document.getElementById('side-lat').innerText = Math.abs(target.lat).toFixed(4) + "¬∞ S";
        document.getElementById('side-lon').innerText = Math.abs(target.lon).toFixed(4) + "¬∞ W";
        document.getElementById('side-hdg').innerText = Math.round(target.heading).toString().padStart(3, '0') + "¬∞";
        document.getElementById('side-spd').innerText = (target.speed + (Math.random()*0.3)).toFixed(1) + " KTS";
        
        const confEl = document.getElementById('side-conf');
        confEl.innerText = count > 1 ? "!!! JOINT LOCK !!!" : "60% PREDICTIVE";
        confEl.style.color = count > 1 ? "var(--hostile-red)" : "var(--alert-yellow)";

        let minDist = Infinity; let port = "";
        for(let p in PORTS) {
            let d = map.distance([target.lat, target.lon], PORTS[p]);
            if(d < minDist) { minDist = d; port = p; }
        }
        document.getElementById('side-tat').innerText = `${port} (${(minDist / (target.speed * 1852)).toFixed(1)} hrs)`;
    }

    function hideHUD() { document.getElementById('target-data').style.display = 'none'; document.getElementById('wait-msg').style.display = 'block'; document.getElementById('coord-header').innerText = "IDLE"; }
    function takeAction(act) { addLog(`ACTION_REQ: ${act}`); alert(`ENVIANDO PROTOCOLO: ${act}`); closeMenu(); }
    function closeMenu() { document.getElementById('action-menu').style.display = 'none'; }
</script>
</body>
</html>
